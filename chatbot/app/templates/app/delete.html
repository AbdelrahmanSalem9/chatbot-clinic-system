<!DOCTYPE html>
<html>

<head>
    {% load static %}
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Appointment Form</title>
</head>
<link rel="stylesheet" href="{% static 'css/appointment.css' %}">

<body>
    <form id="delete-form" style="margin: auto;" method="POST" action="">
        {% csrf_token %}
        <label for="email">E-mail</label>
        <input type="text" id="email" name="email" required>
        <br>
        <label for="doctor">The Doctor</label>
        <select name="doctor" id="doctor" required>
            <option value="0">select the doctor</option>
            {% for doctor in doctors %}
            <option value="{{ doctor.pk }}">{{ doctor.name }}</option>
            {% endfor %}
        </select>
        <br>
        <label for="appointment_id">Appointment ID</label>
        <input type="text" id="appointment_id" name="appointment_id" required>
        <br>
        <button type="submit" onclick="submitForm(event)">Delete</button>
    </form>
</body>
<script>
    function submitForm(event) {
        event.preventDefault(); // Prevent form from submitting automatically

        // Get the input value
        var email = document.getElementById("email").value;
        var doctor = document.getElementById("doctor").value;
        var appointment_id = document.getElementById("appointment_id").value;

        var xhr = new XMLHttpRequest();
        xhr.open("POST", "/delete/");
        xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        xhr.setRequestHeader("X-CSRFToken", document.getElementsByName("csrfmiddlewaretoken")[0].value);
        xhr.onload = function () {
            if (xhr.status === 200) {
                var response = JSON.parse(xhr.responseText);
                alert(response.message);
                if (response.deleted == "True")
                    window.location.href = "/chat";
            }
        };
        var data = {
            "doctor_id": document.getElementById("doctor").value,
            "patient_email": document.getElementById("email").value,
            "appointment_id": document.getElementById("appointment_id").value,
        };
        xhr.send(JSON.stringify(data));
    }
</script>

</html>